<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "splunk_glance-doc.ent">
%BOOK_ENTITIES;
]>
<article>
  <xi:include href="Article_Info.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />

  <section id="s1-overview">
    <title>Overview</title>
    <para>I would like to describe the integration between Glance(<ulink
      url="http://glance.openstack.org/"/>) and Splunk (<ulink
      url="http://www.splunk.com/"/>)</para>
    <itemizedlist>
      <listitem>
	<para>Glance provides services used by OpenStack project for
          discovering, registering, and retrieving virtual machine images.</para>
      </listitem>
      <listitem>
	<para>Splunk is a software used for collecting, indexing from various
          sources which can be analysed. Splunk has web-gui through which you can easily
          display graphs, statistics of collected data.</para>
      </listitem>
    </itemizedlist>
    <para>The goal of this document is to show possibilities how the logs
      generated by Glance can be transferred to Splunk. The suggested solution should
      be redundant to prevent hardware failures break the logging infrastructure. You
      can find the necessary files and sources in the repository: <ulink
      url="https://github.com/ruzickap/splunk_glance"/>.</para>
  </section>

  <section id="s1-reference-architecture-configuration">
    <title>Reference Architecture Configuration</title>
      <para>For the simulations I decided to use free software as much as
      possible and visualised hardware. It's not a priority right now to describe in
      details which hardware is needed for real production, because this is
      suggestions how the things can work. It's the same with software â€“ for
      production server it's better to buy supported OS from known vendors, but it
      depends how big the final solution.</para>
    <section id="s3-software_configuration">
      <title>Software Configuration</title>
      <section id="s2-operating_systems">
        <title>Operating Systems</title>
	  <para>I choose CentOS (<ulink url="http://www.centos.org"/>) as the
          operating system for the whole solution. It's 64-bit version OS based on Red
          Hat Enterprise Linux. The advantage of this choice is - CentOS
          is binary compatible with RHEL. If it will be necessary to move the
          applications to the RHEL it can be done quite easily.</para>
      </section>

      <section id="s4-applications_tools_and_packages">
        <title>Applications, Tools and Packages</title>
	  <para>Here is a short list of used applications and their versions.
          There should be mentioned much more, but it's not necessary to list
          all the installed packages and their versions.</para>
        <table id="software_versions" frame='all'>
          <title>Software versions</title>
          <tgroup cols='2' align='center' colsep='1' rowsep='1'>
            <thead>
                <row>
                  <entry>Software</entry>
                  <entry>Version</entry>
                </row>
            </thead>
            <tbody>
                <row>
                  <entry>Splunk</entry>
                  <entry><systemitem> 4.3.1-119532 </systemitem></entry>
                </row>
                <row>
                  <entry>Glance</entry>
                  <entry><systemitem>2011.3.1-3.el6</systemitem></entry>
                </row>
            </tbody>
          </tgroup>
        </table>
      </section>
    </section>

    <section id="s3-hardware_configuration">
      <title>Hardware Configuration</title>
	<para>There only hardware I used was my laptop with virtualization.
          This was sufficient for the basics tests.
        </para>
    </section>
  </section>
  <section id="s1-environment">
    <title>Environment</title>
    <para>As I mentioned before, the project should describe the
      possibilities of logging glance logs to the splunk. For this purpose I
      used 2 virtual machines, where Fedora 16 (<ulink
      url="http://www.fedora.org"/>) was the host and CentOS 6.2 were two
      guests.
    </para>
    <section id="s2-virtual_host_configuration">
      <title>Virtual Host Configuration</title>
      <para>I was using KVM virtualization which is the default in most of the
        Linux distribution, because the <application>kvm</application> module is part
        of the kernel. I used the dafault <application>libvirt</application> network
        configuration, because there is no reason to split the virtual network - so
        both virtual guests are connected <systemitem
        class="ipaddress">192.168.122.0/24</systemitem>.
      </para>
      <important>
	<title>Important - Virtual servers must have two NICs
          interfaces
        </title>
	<para>It's necessary for both virtual guest to have 2 network
          interfaces connected to the same virtual network otherwise the installation
          will fail.
        </para>
      </important>
      <para>
      Here you can find the details about network configuration of each Virtual machine:
      </para>

      <table id="virtual_guests_network_configuration" frame="all">
        <title>Network Configuration of Virtual Guests</title>
        <tgroup align="left" cols="3" colsep="1" rowsep="1">
          <thead>
            <row>
              <entry></entry>
              <entry>centos6-glance</entry>
              <entry>centos6-splunk</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>Network</entry>
              <entry><systemitem class="ipaddress">192.168.122.0</systemitem></entry>
              <entry><systemitem class="ipaddress">192.168.122.0</systemitem></entry>
            </row>
            <row>
              <entry>IP address</entry>
              <entry><systemitem class="ipaddress">192.168.122.200</systemitem></entry>
              <entry><systemitem class="ipaddress">192.168.122.205</systemitem></entry>
            </row>
            <row>
              <entry>Netmask</entry>
              <entry><systemitem class="ipaddress">255.255.255.0</systemitem></entry>
              <entry><systemitem class="ipaddress">255.255.255.0</systemitem></entry>
            </row>
            <row>
              <entry>Gateway</entry>
              <entry><systemitem class="ipaddress">192.168.122.1</systemitem></entry>
              <entry><systemitem class="ipaddress">192.168.122.1</systemitem></entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <para>
        Any special DNS configuration is not required.
      </para>

      <note>
        <title>Note</title>
        <para>
  	  The full hostnames of the wirtual machines are:
          <literal>centos6-glance.example.com</literal> and
          <literal>centos6-splunk.example.com</literal>.
        </para>
      </note>

      <para>
	I configured both virtual guests with the following parameters:
      </para>

      <table id="virtual_guests_parameters" frame="all">
        <title>Virtual Guests Specifications</title>
        <tgroup align="left" cols="3" colsep="1" rowsep="1">
          <colspec colname="col1" colnum="1" colwidth="3*"></colspec>
          <colspec colname="col2" colnum="2" colwidth="2*"></colspec>
          <colspec colname="col3" colnum="3" colwidth="2*"></colspec>
          <thead>
            <row>
              <entry>Amount of RAM in the System</entry>
              <entry>Disk space</entry>
              <entry>Amount of CPUs</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>1GB of RAM</entry>
              <entry>8GB of disk space</entry>
              <entry>2 CPUs</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>

    <section id="s2-network_topology">
      <title>Network Topology</title>
      <para>
	You can find the Network diagram below.
      </para>

      <figure float="0">
        <title>Network Topology</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="./images/network_topology.svg" format="SVG" width="500" />
          </imageobject>
        </mediaobject>
      </figure>
    </section>
  </section>
  <section id="s1-installation">
    <title>Installation</title>
    <para>
      As i mentioned before in the <xref linkend="s2-virtual_host_configuration"/> you need to configure your
environment or use the defaults. You will also need to download the CentOS iso
image.
    </para>

    <note>
      <title>Note - Use already preconfigured CentOS image</title>
      <para>
	I can recommend you to use preconfigured CentOS image, which can be
        downloaded on this URL: 
        <ulink url="http://raw.github.com/ruzickap/splunk_glance/master/iso/CentOS-6.2-x86_64-netinstall-my.iso"/>
      </para>
    </note>

    <para>
      If you will use the customized CentOS iso, you don't need to specify manually the following kernel parameters:
    </para>
    <screen><userinput>ksdevice=eth0 ks=http://raw.github.com/ruzickap/splunk_glance/master/ks/centos62-glance ip=192.168.122.200 netmask=255.255.255.0 gateway=192.168.122.1</userinput></screen>
    <para>
      You will be able to select directly from the main menu what you want to install:
    </para>
    <figure float="0">
      <title>Menu from customized CentOS iso</title>
      <mediaobject>
        <imageobject>
          <imagedata fileref="./images/customized_centos_menu.png" format="PNG" width="400" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>
      The installation will require the connection to the Internet, because some parts are downloaded directly from the github, EPEL and other destinations.
    </para>


  </section>


  <xi:include href="Revision_History.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
</article>
